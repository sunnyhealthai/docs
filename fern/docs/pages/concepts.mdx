---
title: Key Concepts
subtitle: Core concepts for understanding the Sunny Agents SDK
slug: concepts
description: Learn about conversations, messages, artifacts, and authentication in the Sunny Agents SDK.
---

Understanding these core concepts will help you build effective healthcare concierge experiences with the Sunny Agents SDK. Whether you're building provider search, appointment booking, or health information tools, these concepts form the foundation of your application.

## Conversations

A **conversation** is a collection of messages between a patient (or healthcare user) and the AI concierge. Each conversation has:

- **ID**: A unique identifier (UUID)
- **Title**: Optional human-readable title (can be auto-generated)
- **Messages**: Array of messages in chronological order
- **Quick Responses**: Optional suggested responses for the user

Conversations can be:
- **Server-persisted**: Created and stored on the server (requires authentication)
- **Local-only**: Stored only in the client's memory (anonymous mode)

```typescript
interface ConversationState {
  id: string;
  title?: string | null;
  messages: SunnyAgentMessage[];
  quickResponses?: string[];
}
```

## Messages

A **message** represents a single exchange in a conversation. Messages have:

- **ID**: Unique identifier
- **Role**: `'user'`, `'assistant'`, or `'system'`
- **Text**: The message content
- **Created At**: Timestamp
- **Is Streaming**: Whether the message is currently being streamed
- **Output Items**: Rich content items (artifacts, approval requests, etc.)
- **Feedback**: Optional user feedback (positive/negative)

```typescript
interface SunnyAgentMessage {
  id: string;
  role: 'user' | 'assistant' | 'system';
  text: string;
  createdAt: string;
  isStreaming?: boolean;
  outputItems?: SunnyAgentMessageItem[];
  feedback?: boolean | null;
}
```

### Message Roles

- **User**: Messages sent by the user
- **Assistant**: Messages generated by the AI
- **System**: System-level messages (rarely used)

## Artifacts

**Artifacts** are rich content objects referenced in messages. Common examples include:

- **Doctor Profiles**: Healthcare provider information with NPI, specialty, ratings, etc.
- **Structured Data**: Custom data objects specific to your use case

Artifacts are fetched on-demand using the `getArtifact` method and are automatically cached:

```typescript
const artifact = await client.getArtifact<DoctorProfileArtifact>("artifact-id");
```

## Authentication

The SDK supports two authentication modes:

### Authenticated Mode

Uses token exchange to convert ID tokens (from Auth0, Firebase, etc.) into access tokens:

1. Your app provides an ID token via `idTokenProvider`
2. SDK exchanges it for an access token
3. Access token is used for WebSocket and API authentication
4. Token is automatically refreshed when expired

```typescript
const client = new SunnyAgentsClient({
  idTokenProvider: async () => localStorage.getItem("id_token"),
  tokenExchange: {
    partnerName: "your-partner-name",
    audience: "https://api.sunnyhealthai-staging.com",
    clientId: "your-client-id",
  },
});
```

### Anonymous Mode

No authentication required. Conversations are local-only:

```typescript
const client = new SunnyAgentsClient({
  websocketUrl: "wss://chat.api.sunnyhealthai-staging.com",
  authorizeUrl: "https://chat.api.sunnyhealthai-staging.com/authorize",
  createServerConversations: false,
});
```

## WebSocket Connection Lifecycle

The SDK manages WebSocket connections automatically:

1. **Authorization**: Get WebSocket URL and session ID
2. **Connection**: Establish WebSocket connection
3. **Messaging**: Send/receive messages
4. **Reconnection**: Automatically reconnect on failure
5. **Cleanup**: Close connection when client is destroyed

## Events

The SDK uses an event-driven architecture. Subscribe to events to update your UI:

- **`snapshot`**: Emitted when state changes
- **`conversationCreated`**: New conversation created
- **`messagesUpdated`**: Messages updated
- **`streamingDelta`**: Text streaming in real-time
- **`streamingDone`**: Streaming completed
- **`quickResponses`**: Quick response suggestions available

```typescript
client.on("snapshot", (snapshot) => {
  // Update UI with latest state
});

client.on("streamingDelta", ({ conversationId, messageId, text }) => {
  // Update UI with streaming text
});
```

## MCP Approvals

**MCP (Model Context Protocol) Approvals** allow users to approve or reject tool execution requests. When the AI needs to execute a tool, it sends an approval request:

```typescript
// Approve a request
await client.sendMcpApproval(
  conversationId,
  approvalRequestId,
  true, // approve
  "Looks good" // optional reason
);

// Reject a request
await client.sendMcpApproval(
  conversationId,
  approvalRequestId,
  false, // reject
  "Not needed" // optional reason
);
```

## File Attachments

Send files as base64-encoded attachments:

```typescript
await client.sendMessage("Analyze this image", {
  files: [
    {
      filename: "image.png",
      content: "base64-encoded-content",
    },
  ],
});
```

## State Management

The SDK maintains state internally. Access it via:

```typescript
const snapshot = client.getSnapshot();
// {
//   conversations: ConversationState[],
//   activeConversationId: string | null
// }
```

State updates trigger events, allowing you to keep your UI in sync.

## Learn more

<CardGroup cols={2}>
  <Card
    title="Messaging"
    icon="duotone message"
    href="/messaging"
  >
    Deep dive into sending messages and handling responses
  </Card>
  <Card
    title="Conversations"
    icon="duotone comments"
    href="/conversations"
  >
    Learn how to manage multiple conversations
  </Card>
  <Card
    title="Authentication"
    icon="duotone lock"
    href="/authentication"
  >
    Set up authenticated sessions with token exchange
  </Card>
  <Card
    title="Artifacts"
    icon="duotone box"
    href="/artifacts"
  >
    Fetch and render rich content objects
  </Card>
</CardGroup>
