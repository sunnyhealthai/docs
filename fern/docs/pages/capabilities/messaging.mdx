---
title: Messaging
subtitle: Send messages and receive streaming responses
slug: messaging
---

The messaging capability is at the core of the Sunny Agents SDK. Learn how to send messages, handle streaming responses, attach files, and work with message events.

## Sending messages

Send a message using the `sendMessage` method:

```typescript
await client.sendMessage("I need to find a primary care doctor near me");
```

### Message options

Customize message behavior with options:

```typescript
await client.sendMessage("I have a question about my prescription", {
  conversationId: "conversation-id", // Target specific conversation
  title: "Prescription Question", // Set conversation title
  files: [
    {
      filename: "prescription.jpg",
      content: "base64-encoded-content",
    },
  ],
  onMessageCreated: (messageId) => {
    console.log("Message created:", messageId);
  },
});
```

## Streaming responses

Messages stream in real-time as they're generated. Listen to streaming events:

```typescript
// Listen to streaming text deltas
client.on("streamingDelta", ({ conversationId, messageId, text }) => {
  console.log("Streaming:", text);
  // Update UI with partial text
});

// Listen to streaming completion
client.on("streamingDone", ({ conversationId, messageId, text }) => {
  console.log("Complete:", text);
  // Message is complete
});
```

### Streaming states

Messages have an `isStreaming` property that indicates if they're currently being streamed:

```typescript
const snapshot = client.getSnapshot();
const conversation = snapshot.conversations.find(
  (c) => c.id === snapshot.activeConversationId
);

conversation?.messages.forEach((message) => {
  if (message.isStreaming) {
    console.log("Streaming:", message.text);
  } else {
    console.log("Complete:", message.text);
  }
});
```

## File attachments

Send files as base64-encoded attachments:

```typescript
// Convert file to base64
const file = document.getElementById("file-input").files[0];
const reader = new FileReader();

reader.onload = async () => {
  const base64Content = reader.result.split(",")[1]; // Remove data URL prefix
  
  await client.sendMessage("Analyze this file", {
    files: [
      {
        filename: file.name,
        content: base64Content,
      },
    ],
  });
};

reader.readAsDataURL(file);
```

### Supported file types

The SDK accepts any file type. The AI will process the file based on its type:

- **Images**: PNG, JPEG, GIF, WebP
- **Documents**: PDF, DOCX, TXT
- **Other**: Any file type

## Message events

Subscribe to message-related events:

### Snapshot updates

Get notified when state changes:

```typescript
client.on("snapshot", (snapshot) => {
  // State has changed, update UI
  const conversation = snapshot.conversations.find(
    (c) => c.id === snapshot.activeConversationId
  );
  // Render messages
});
```

### Messages updated

Get notified when messages are updated:

```typescript
client.on("messagesUpdated", ({ conversationId, messages }) => {
  console.log("Messages updated:", messages);
  // Update UI with new messages
});
```

### Quick responses

Get suggested quick responses:

```typescript
client.on("quickResponses", ({ conversationId, quickResponses }) => {
  console.log("Quick responses:", quickResponses);
  // Show quick response buttons
});
```

## Message structure

Messages have the following structure:

```typescript
interface SunnyAgentMessage {
  id: string; // Unique message ID
  role: 'user' | 'assistant' | 'system'; // Message role
  text: string; // Message text content
  createdAt: string; // ISO timestamp
  isStreaming?: boolean; // Whether currently streaming
  outputItems?: SunnyAgentMessageItem[]; // Rich content items
  feedback?: boolean | null; // User feedback (true=positive, false=negative)
}
```

## Message roles

- **`user`**: Messages sent by the user
- **`assistant`**: Messages generated by the AI
- **`system`**: System-level messages (rarely used)

## Output items

Messages can contain rich content items:

```typescript
interface SunnyAgentMessageItem {
  type?: string; // Item type (e.g., "mcp_approval_request")
  id?: string; // Item ID
  name?: string; // Item name
  server_label?: string; // Server-provided label
  arguments?: unknown; // Item arguments
  approval_request_id?: string; // For approval requests
  content?: SunnyAgentMessageContentFragment[]; // Content fragments
}
```

Common output item types:
- **`mcp_approval_request`**: Tool execution approval request
- **`message`**: Text message content
- **`artifact`**: Reference to an artifact

## Markdown support

Assistant messages support markdown formatting:

- **Bold**: `**text**`
- **Italic**: `*text*`
- **Links**: `[text](url)`
- **Line breaks**: Newlines are preserved

The vanilla widget automatically renders markdown. For custom UIs, you'll need to parse and render it yourself.

## Error handling

Handle errors when sending messages:

```typescript
try {
  await client.sendMessage("Hello!");
} catch (error) {
  console.error("Failed to send message:", error);
  // Handle error (e.g., show error message to user)
}
```

Common errors:
- **Connection errors**: WebSocket connection failed
- **Authentication errors**: Invalid or expired token
- **Rate limiting**: Too many requests

## Best practices

1. **Show loading states**: Display a loading indicator while `isStreaming` is true
2. **Handle streaming**: Update UI incrementally as text streams in
3. **Cache messages**: Store messages locally for offline access
4. **Error handling**: Always handle errors gracefully
5. **File size limits**: Consider file size limits for attachments

## Examples

### Basic message

```typescript
await client.sendMessage("Find me a cardiologist in San Francisco");
```

### Message with callback

```typescript
await client.sendMessage("I need to book an appointment", {
  onMessageCreated: (messageId) => {
    console.log("Message ID:", messageId);
    // Show loading indicator
  },
});
```

### Message with file

```typescript
const file = await getFileFromUser(); // e.g., insurance card image
const base64 = await fileToBase64(file);

await client.sendMessage("Can you help me understand my insurance coverage?", {
  files: [
    {
      filename: file.name,
      content: base64,
    },
  ],
});
```

## Next steps

- **[Conversations](/conversations)** - Learn about managing conversations
- **[Artifacts](/artifacts)** - Fetch and render rich content
- **[Custom UI Tutorial](/custom-ui)** - Build a custom chat interface
