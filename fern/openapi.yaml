openapi: 3.1.0
servers:
  - url: https://api.sunnyhealthai-staging.com
    description: Production API server
  - url: https://chat.api.sunnyhealthai-staging.com
    description: Chat WebSocket and authorization server
info:
  description: |
    The Sunny Agents SDK provides a TypeScript/JavaScript library designed specifically for building healthcare concierge applications. Embed AI-powered chat experiences that help patients find providers, book appointments, get health information, and navigate careâ€”all in real-time.
    
    ### Key Features
    - **Headless Client**: Build custom healthcare chat UIs with full control over the interface
    - **Vanilla Widget**: Drop-in healthcare concierge widget for quick integration
    - **Real-time Messaging**: WebSocket-based streaming responses for instant care guidance
    - **Token Exchange**: Secure authentication flow using ID tokens for HIPAA-compliant sessions
    - **Artifact Support**: Fetch and render rich content like doctor profiles, provider information, and appointment details
    - **MCP Approvals**: Handle tool execution approvals interactively for secure healthcare operations
    
    ### Authentication
    The SDK supports two modes:
    - **Authenticated Mode**: Uses token exchange to convert ID tokens to access tokens
    - **Anonymous Mode**: Local-only conversations without server persistence
    
    ### Developer Notes
    - WebSocket connections are managed automatically by the SDK
    - Token exchange is handled transparently when configured
    - Artifacts (like doctor profiles) are automatically cached for performance
    - Designed for healthcare use cases: provider search, appointment booking, health information, and benefits navigation
  version: 1.0.0
  title: Sunny Agents SDK API
  contact:
    name: Sunny Agents SDK Support
    email: support@sunnyhealthai.com
  license:
    name: MIT
    url: "https://opensource.org/licenses/MIT"
tags:
  - name: chat
    description: WebSocket-based chat messaging operations
  - name: conversations
    description: Conversation management operations
  - name: artifacts
    description: Chat artifact fetching and management
  - name: authentication
    description: Authentication and token exchange operations
paths:
  /authorize:
    get:
      tags:
        - authentication
      summary: Authorize WebSocket connection
      description: |
        Get authorization credentials for establishing a WebSocket connection.
        Returns a WebSocket URL and session ID for connecting to the chat service.
      operationId: authorize
      security:
        - BearerAuth: []
      parameters:
        - name: session_id
          in: query
          description: Optional existing session ID to reuse
          required: false
          schema:
            type: string
      responses:
        "200":
          description: Authorization successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthorizeResponse"
              examples:
                exampleResponse:
                  summary: Successful authorization
                  value:
                    websocket_url: "wss://chat.api.sunnyhealthai-staging.com/ws?session_id=abc123"
                    session_id: "abc123"
                    expires_at: "2024-01-01T12:00:00Z"
        "401":
          description: Unauthorized - Invalid or missing access token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /oauth/token:
    post:
      tags:
        - authentication
      summary: Exchange ID token for access token
      description: |
        Exchange an ID token for an access token using OAuth 2.0 token exchange.
        This endpoint is used internally by the SDK when token exchange is configured.
      operationId: tokenExchange
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              type: object
              required:
                - grant_type
                - subject_token
                - subject_token_type
                - audience
                - client_id
              properties:
                grant_type:
                  type: string
                  example: "urn:ietf:params:oauth:grant-type:token-exchange"
                subject_token:
                  type: string
                  description: The ID token to exchange
                subject_token_type:
                  type: string
                  description: Token type identifier (e.g., "urn:sunny-health-external-mock:id-token")
                audience:
                  type: string
                  description: API audience for the access token
                  example: "https://api.sunnyhealthai-staging.com"
                client_id:
                  type: string
                  description: Auth0 client ID
      responses:
        "200":
          description: Token exchange successful
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenExchangeResponse"
              examples:
                exampleResponse:
                  summary: Successful token exchange
                  value:
                    access_token: "eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9..."
                    token_type: "Bearer"
                    expires_in: 3600
        "400":
          description: Invalid request
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "401":
          description: Invalid ID token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
  /v1/chat-artifacts/{artifactId}:
    get:
      tags:
        - artifacts
      summary: Fetch a chat artifact
      description: |
        Retrieve a chat artifact by its ID. Artifacts are rich content objects
        referenced in chat messages, such as doctor profiles or other structured data.
        Requires authenticated access.
      operationId: getArtifact
      security:
        - BearerAuth: []
      parameters:
        - name: artifactId
          in: path
          required: true
          description: The artifact ID to fetch
          schema:
            type: string
            example: "artifact_abc123"
      responses:
        "200":
          description: Artifact retrieved successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ChatArtifact"
              examples:
                doctorProfile:
                  summary: Doctor profile artifact
                  value:
                    id: "artifact_abc123"
                    item_type: "doctor_profile"
                    item_content:
                      npi: "1234567890"
                      first_name: "Jane"
                      last_name: "Smith"
                      specialty: "Cardiology"
                      rating: 4.8
                      review_count: 150
        "401":
          description: Unauthorized - Authentication required
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
        "404":
          description: Artifact not found
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/Error"
components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: Access token obtained via token exchange
  schemas:
    AuthorizeResponse:
      type: object
      required:
        - websocket_url
        - session_id
        - expires_at
      properties:
        websocket_url:
          type: string
          format: uri
          description: WebSocket URL for chat connection
          example: "wss://chat.api.sunnyhealthai-staging.com/ws?session_id=abc123"
        session_id:
          type: string
          description: Session identifier for the WebSocket connection
        expires_at:
          type: string
          format: date-time
          description: Session expiration timestamp
    TokenExchangeResponse:
      type: object
      required:
        - access_token
        - token_type
        - expires_in
      properties:
        access_token:
          type: string
          description: Access token for API authentication
        token_type:
          type: string
          example: "Bearer"
        expires_in:
          type: integer
          description: Token expiration time in seconds
          example: 3600
    ChatArtifact:
      type: object
      required:
        - id
        - item_type
        - item_content
      properties:
        id:
          type: string
          description: Unique artifact identifier
        item_type:
          type: string
          description: Type of artifact (e.g., "doctor_profile")
          example: "doctor_profile"
        item_content:
          type: object
          description: Artifact content (structure varies by type)
          additionalProperties: true
        content:
          type: object
          description: Alternative content field (for backward compatibility)
          additionalProperties: true
    DoctorProfileArtifact:
      type: object
      properties:
        npi:
          type: string
          description: National Provider Identifier
        first_name:
          type: string
        last_name:
          type: string
        title:
          type: string
        specialty:
          type: string
        languages_spoken:
          type: array
          items:
            type: string
        gender:
          type: string
        rating:
          type: number
          format: float
        review_count:
          type: integer
        last_updated_at:
          type: string
          format: date-time
        locations:
          type: object
          additionalProperties: true
        rank_score:
          type: number
          format: float
        mrf_rates:
          type: array
          items:
            type: object
            additionalProperties: true
        out_of_pocket_costs:
          type: array
          items:
            $ref: "#/components/schemas/OutOfPocketCost"
    OutOfPocketCost:
      type: object
      properties:
        procedure_code:
          type: string
        procedure_code_type:
          type: string
        procedure_name:
          type: string
        rate:
          type: number
        out_of_pocket:
          type: number
    Conversation:
      type: object
      required:
        - id
        - messages
      properties:
        id:
          type: string
          description: Unique conversation identifier
        title:
          type: string
          nullable: true
          description: Optional conversation title
        messages:
          type: array
          items:
            $ref: "#/components/schemas/Message"
        quickResponses:
          type: array
          items:
            type: string
          description: Suggested quick response options
    Message:
      type: object
      required:
        - id
        - role
        - text
        - createdAt
      properties:
        id:
          type: string
          description: Unique message identifier
        role:
          type: string
          enum: [user, assistant, system]
          description: Message role
        text:
          type: string
          description: Message text content
        createdAt:
          type: string
          format: date-time
          description: Message creation timestamp
        isStreaming:
          type: boolean
          description: Whether the message is currently streaming
        outputItems:
          type: array
          items:
            $ref: "#/components/schemas/MessageItem"
          description: Rich content items in the message
        feedback:
          type: boolean
          nullable: true
          description: User feedback on the message (true=positive, false=negative)
    MessageItem:
      type: object
      properties:
        type:
          type: string
          description: Item type (e.g., "message", "mcp_approval_request")
        id:
          type: string
          description: Item identifier
        name:
          type: string
          description: Item name
        server_label:
          type: string
          description: Server-provided label
        arguments:
          type: object
          additionalProperties: true
          description: Item arguments (structure varies by type)
        approval_request_id:
          type: string
          description: Approval request ID (for MCP approval items)
        approve:
          type: boolean
          description: Approval decision (for MCP approval responses)
        reason:
          type: string
          nullable: true
          description: Reason for approval/rejection
        content:
          type: array
          items:
            $ref: "#/components/schemas/MessageContentFragment"
          description: Content fragments
    MessageContentFragment:
      type: object
      properties:
        type:
          type: string
        text:
          type: string
    Error:
      type: object
      required:
        - message
      properties:
        message:
          type: string
          description: Error message
        code:
          type: string
          description: Error code
        details:
          type: object
          additionalProperties: true
          description: Additional error details
